version: '0.1'

services:
  web-app:
    build: .
    container_name: flask_app_jan
    restart: unless-stopped
    depends_on:
      - postgres
    environment:
      VIRTUAL_PROTO: uwsgi
      VIRTUAL_PORT: 3031
    networks:
      - backend
    volumes:
      - ./src:/home/app/src
  nginx:
    image: nginxproxy/nginx-proxy:1.7
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - /var/run/docker.sock:/tmp/docker.sock:ro
      - data_static:/home/app/src/app/static:ro
      - cache_nginx:/var/cache/nginx
      - state_nginx:/etc/nginx
    depends_on:
      - web-app
    networks:
      - backend
    read_only: true
  postgres:
    image: postgres:15
    container_name: postgres_jan
    restart: unless-stopped
    volumes:
      - pgdata:/var/lib/postgresql/data
    networks:
      - backend
    read_only: true

volumes:
  data_static: {}
  cache_nginx: {}
  state_nginx: {}
  pgdata: {}

networks:
  backend: {}
